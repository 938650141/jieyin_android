# 戒瘾助手 - 核心算法说明

## 概述
戒瘾助手是一个帮助用户戒除成瘾行为的Android应用，通过记录日常活动（成功、失败、运动、睡眠）来计算用户的戒瘾状态评分。

## 评分系统

### 评分范围
- **0-19.99分**: 严重成瘾 (红色)
- **20-39.99分**: 重度成瘾 (深橙色)
- **40-59.99分**: 中度成瘾 (橙色)
- **60-79.99分**: 轻度成瘾 (黄色)
- **80-94.99分**: 即将戒除 (绿色)
- **95-100分**: 已戒除 (蓝色)

### 基础分
- 初始基础分：**60分**

## 核心算法规则

### 评分单位和限制
- **评分单位**: 0.01分（所有加减分都是0.01的倍数）
- **每日加分上限**: 每天加分最多0.5分
- **失败扣分上限**: 单次失败最多扣3分（指数增长机制下）

### 1. 成功记录 (SUCCESS)
- **计分方式**: 根据距离上次成功或失败的时间间隔加分
- **公式**: 时间间隔（小时）× 0.01（不满一小时部分不计入得分）
- **上限**: 单次最多加0.5分
- **说明**: 
  - 时间间隔越长，得分越高
  - 鼓励长期保持戒除状态

### 2. 失败记录 (FAILURE)
- **计分方式**: 根据失败频率和最近失败的密集程度扣分，采用**指数型增长**
- **公式**: 
  - 基础扣分 = 0.10分
  - 频率因子: 基础扣分 × 1.5^(30天内失败次数 - 1)
  - 时间因子: 如果距离上次失败不到7天，额外乘以 1 + e^(-距离小时数/24)
  - 抵消因子: 如果当天有运动或睡眠（正分）记录，将这些得分加入扣分以抵消
- **上限**: 单次最多扣3分
- **时间窗口**: 过去30天内的所有失败记录都会影响当前扣分计算
- **说明**:
  - 短期内频繁失败会导致**指数级**扣分增长
  - 距离上次失败越近，扣分越多
  - 当天的运动和睡眠得分会被失败抵消

### 3. 运动记录 (EXERCISE)
- **计分方式**: 确认当日运动超过30分钟后加分
- **公式**: 超过30分钟 = +0.1分
- **限制**: 
  - 当天有失败记录时**可以记录**，但加分为0
  - 如果先记录运动后记录失败，运动的得分会被算入失败的扣分里抵消
- **说明**:
  - 运动是戒除成瘾的重要辅助手段
  - 通过确认对话框记录，无需输入时长

### 4. 睡眠记录 (SLEEP)
- **计分方式**: 根据输入的睡眠得分（百分制）计算加分或扣分
- **公式**: (睡眠得分 - 60) × 0.01
- **限制**: 
  - 加分时，当天有失败记录则加分为0（**可以记录**但不加分）
  - 如果先记录睡眠后记录失败，睡眠的正分会被算入失败的扣分里抵消
  - 扣分时，无视当天是否有失败记录
- **上限**: 单次最多加0.5分或扣0.5分
- **说明**:
  - 睡眠得分高于60则加分
  - 睡眠得分低于60则扣分
  - 睡眠质量差即使当天失败也会被扣分

## 算法特点

### 1. 长期追踪
- 所有记录都会被永久保存
- 支持查看最近10条记录
- 每条记录显示加分/扣分情况
- 一周内的记录可以修改或删除
- 可以清空所有数据重新开始

### 2. 指数惩罚机制
- **频繁失败惩罚**: 30天内失败次数越多，每次失败的扣分指数级增长
- **时间接近惩罚**: 距离上次失败越近，额外扣分越多
- **抵消机制**: 失败会抵消当天的运动和睡眠正分

### 3. 合理性设计
- **分数有上下限**: 0-100分，防止极端值
- **时间窗口**: 30天内的失败记录影响扣分计算
- **平衡激励**: 正向行为（运动、良好睡眠）可以弥补失败的负面影响，但当天失败会抵消

### 4. 心理学依据
- **即时反馈**: 每次记录后立即显示分数变化
- **可视化等级**: 用颜色和文字清晰展示当前状态
- **正向强化**: 成功和健康行为都能得到积分奖励
- **负向惩罚**: 失败会扣分，频繁失败指数级惩罚

## 使用建议

1. **每日记录**: 建议每天至少记录一次（成功或其他活动）
2. **诚实记录**: 准确记录失败，这样算法才能真实反映状态
3. **多元活动**: 结合运动、良好睡眠来提升分数
4. **长期坚持**: 戒除成瘾是长期过程，坚持使用才能看到效果
5. **避免连续失败**: 由于指数惩罚机制，连续失败的代价会越来越大

## 技术实现

### 数据存储
- 使用SharedPreferences + Gson存储
- 支持离线使用
- 数据保存在本地，保护隐私

### 核心类
- `AddictionScoreCalculator`: 核心算法实现
- `ActivityStorage`: 数据存储管理
- `MainActivity`: 主界面和用户交互

### 测试覆盖
- 包含完整的单元测试
- 验证各种场景下的评分逻辑
- 确保分数在合理范围内

## 未来改进方向

1. 添加数据统计图表
2. 支持导出/导入数据
3. 添加提醒功能
4. 个性化算法参数设置
5. 添加目标设定和里程碑
